"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const e={"Content-Type":"application/json"},t=(e,t="")=>{if("object"==typeof e&&e.errno)throw new TypeError(`Fetch ${t} failed with ${e.errno}: ${e.errmsg}`);return e},r=({serverURL:e,lang:r,paths:n,signal:a})=>(({serverURL:e,lang:r,paths:n,type:a,signal:o})=>fetch(`${e}/article?path=${encodeURIComponent(n.join(","))}&type=${encodeURIComponent(a.join(","))}&lang=${r}`,{signal:o}).then((e=>e.json())).then((e=>t(e,"article count"))))({serverURL:e,lang:r,paths:n,type:["time"],signal:a}).then((e=>Array.isArray(e)?e:[e])),n=r=>(({serverURL:r,lang:n,path:a,type:o,action:s})=>fetch(`${r}/article?lang=${n}`,{method:"POST",headers:e,body:JSON.stringify({path:a,type:o,action:s})}).then((e=>e.json())).then((e=>t(e,"article count"))))({...r,type:"time"}),a=e=>{const t=((e="")=>e.replace(/\/$/u,""))(e);return/^(https?:)?\/\//.test(t)?t:`https://${t}`},o=e=>{"AbortError"!==e.name&&console.error(e.message)},s=e=>e.dataset.path||e.getAttribute("id"),l=(e,t)=>{t.forEach(((t,r)=>{t.innerText=e[r].toString()}))};exports.pageviewCount=({serverURL:e,path:t=window.location.pathname,selector:i=".waline-pageview-count",update:p=!0,lang:c="zh-CN"})=>{const h=new AbortController,g=Array.from(document.querySelectorAll(i)),u=e=>{const r=s(e);return null!==r&&t!==r},y=n=>r({serverURL:a(e),paths:n.map((e=>s(e)||t)),lang:c,signal:h.signal}).then((e=>l(e,n))).catch(o);if(p){const r=g.filter((e=>!u(e))),o=g.filter(u);n({serverURL:a(e),path:t,lang:c}).then((e=>l(new Array(r.length).fill(e),r))),o.length&&y(o)}else y(g);return h.abort.bind(h)},exports.version="2.13.0";
//# sourceMappingURL=pageview.cjs.map
